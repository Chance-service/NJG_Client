function setCashData(a){var b,c,d;return cashData[a]?(b=cashData[a],b.length<1&&(b=cashData.DEFAULT),c=$("#s_cash"),d=c.val(),c.empty(),$.each(b,function(e,f){c.append("<option value="+f+" "+(d==f?'selected="selected"':"")+">"+f+"元</option>")}),$("input[name=cash]").val($("#s_cash").val()),setCash(),void 0):!0}function cGame(c){$("#s_server").html("<option value='0'>请选择区服</option>");formData.server_id=0;var a=$(c).val(),b=host+"/game-api_ios?act=s&gid="+a+"&r="+Math.random()+"&jsoncallback=?";GameCallback(a),$.getJSON(b,function(d){if(0==d.r&&d.data.total>0){var e=d.list,f="<option value='0'>请选择区服</option>";$(e).each(function(h,i){var g=parseInt(i.sid);servers[g]=i,f+="<option value='"+i.sid+"' code='"+i.code+"'>"+i.name+"</option>"}),$("#s_server").html(f)}})}function ServerCallback(a){$("#s_server_id").val(a);cServer($("#s_server_id"))}function cMoneyCallback(b){$("#showMoney").html(b);$("input[name=cash]").val(b),$(".cash").html(b+"元"),formData.cash=parseInt(b),setCash()}function cServer(a){var d,b=$(a).val(),c=servers[b];formData.server_id=c.code,formData.server_name=c.name,$("input[name=server_id]").val(c.code),d=$("#s_server"),0==d.val()&&d.val(c.sid),checkRole()}function cCash(a){var b=$(a).val();$("input[name=cash]").val(b),$(".cash").html(b+"元"),formData.cash=parseInt(b),setCash()}function mouseOver(a){$(a).css("background-color","#F27200");var b=$(a).find("img");b.attr("src",b.attr("src").replace(".png","a.png"))}function mouseOut(a){$(a).css("background-color","none");var b=$(a).find("img");b.attr("src",b.attr("src").replace("a.png",".png"))}function HistoryCallback(){var a=his.pop();a()}function PayCallback(a){return scrollToTop(),$("div.page,div.rech_box").hide(),0==parseInt(a)?($("#status").hide(),$("#resultBody").show(),$("#failed").show(),$("#success").hide(),void 0):($("#status").hide(),$("#resultBody").show(),$("#failed").hide(),$("#success").show(),void 0)}function UserCallback(a){formData.to_username=a,$("input[name=to_username]").val(a)}function PhoneCallback(a){formData.phone=a,$("input[name=phone]").val(a)}function GameCallback(c){var b,a=games[c];formData.game_id=a.id,formData.game_name=a.name,formData.exchange=a.exchange,formData.currency=a.currency,formData.has_pay_rate=a.has_pay_rate,$("input[name=game_id]").val(a.id),b=$("#s_game"),0==b.val()&&(b.val(a.id),cGame(b))}function setWay(c){setCashData(c),scrollToTop();var a="",b="";if(a=$("input[name=to_username]").val().replace("充值账号：",""),a.length<4||!/^[0-9a-zA-Z_]+$/.test(a)){return alertMsg("请填写账号,4位以上字母或数字"),void 0}if(formData.to_username=a,!formData.game_id||formData.game_id<1){return alertMsg("请选择游戏"),void 0}if(!formData.server_id||formData.server_id<1){return alertMsg("请选择区服"),void 0}if(b=$("input[name=phone]").val().replace("手机号码：",""),b.length>1){if(!/^[0-9]+$/.test(b)){return alertMsg("请填写正确的手机号码"),void 0}formData.phone=b}return formData.way=c,$("input[name=way]").val(c),0==hasUser?(alertMsg("账号不存在，请先注册。"),void 0):0==hasRole?(alertMsg("您在服务器还没有角色。请先创建角色后再充值。"),void 0):null==hasRole?(checkRole(),alertMsg("正在检测所选区服您是否有角色, 请重新点击支付方式。"),void 0):(formData.rate=1,"ALIPAY"==c?showAlipay():"BANK"==c?showBank():"TENPAY"==c?showTenpay():"HUIKUAN"==c?showHuikuan():showCard(),changeTextView(wayData[c],"2"),$("label[name=way_name]").html(wayData[c]),setCash(),his=[closeWin,showWay],void 0)}function showWay(){changeTextView("充值中心","1"),scrollToTop(),his=[closeWin],$("div.page,div.rech_box").hide(),$("div#way").show()}function showBank(){$("div.page,div.rech_box").hide(),$("#body").show(),$("#tenpayBody,#alipayBody,#cardBody,#huikuanBody").hide(),$("#bankBody").show(),setInfo()}function showTenpay(){$("div.page,div.rech_box").hide(),$("#body").show(),$("#bankBody,#alipayBody,#cardBody,#huikuanBody").hide(),$("#tenpayBody").show(),setInfo()}function showAlipay(){$("div.page,div.rech_box").hide(),$("#body").show(),$("#bankBody,#tenpayBody,#cardBody,#huikuanBody").hide(),$("#alipayBody").show(),setInfo()}function setInfo(){$("label[name=to_username]").html(formData.to_username),$("label[name=game_name]").html(formData.game_name),$("label[name=server_name]").html(formData.server_name);var a=formData.way;$("label[name=way_name]").html(wayData[a])}function setCash(){var a=$("input[name=cash]").val();formData.amount=1==parseInt(formData.has_pay_rate)?parseInt(a)*formData.rate*formData.exchange+""+formData.currency:parseInt(a)*formData.exchange+""+formData.currency,$("label[name=cash]").html(a),$("label[name=amount]").html(formData.amount),$("#amount").show()}function showHuikuan(){$("div.page,div.rech_box").hide(),$("#bankBody,#alipayBody,#tenpayBody,#cardBody").hide(),$("#huikuan").show(),setInfo()}function showCard(){$("div.page,div.rech_box").hide(),$("#body").show(),$("#bankBody,#alipayBody,#tenpayBody,#huikuanBody").hide(),$("#cardBody").show(),setInfo()}function showOrder(){var a,b,c,d;if(scrollToTop(),a=$("input[name=cash]").val(),parseInt(a)<0){return alertMsg("请选择充值金额"),void 0}if(b=formData.way,"ALIPAY"!=b&&"BANK"!=b&&"HUIKUAN"!=b&&"TENPAY"!=b){if(c=$("input[name=sn]").val(),d=$("input[name=pass]").val(),!card_verify(formData.way,c,d)){return}his=[closeWin,showWay,showCard]}else{"BANK"==b?his=[closeWin,showWay,showBank]:"ALIPAY"==b?his=[closeWin,showWay,showAlipay]:"TENPAY"==b?his=[closeWin,showWay,showTenpay]:"HUIKUAN"==b&&(his=[closeWin,showWay,showHuikuan])}changeTextView(wayData[b],"2"),submitOrder()}function ExtraCallback(a){$("#extraInfo").attr("name","extra").val(a)}function submitOrder(){var c,a,b;scrollToTop(),$("div.page,div.rech_box").hide(),$("#status").show(),c=formData.way,("ALIPAY"==c||"BANK"==c||"HUIKUAN"==c||"TENPAY"==c)&&($("input[name=sn]").val(""),$("input[name=pass]").val("")),changeTextView(wayData[c],"3"),a=$.param($("#orderForm").serializeArray()),b=host+"/payment-api_wap?"+a+"&jsoncallback=?",$.getJSON(b,function(d){if(1==d.result){if(formData.orderid=d.orderid,"ALIPAY"==formData.way){return d.link&&/^http/.test(d.link)?window.location.href=d.link:($("#resultBody").show(),$("#status").hide(),$("#success").hide(),$("#failedMsg").html("支付请求失败，请重新提交订单"),$("#failed").show()),void 0}if("BANK"==formData.way){return d.link&&/^http/.test(d.link)?window.location.href=d.link:($("#resultBody").show(),$("#status").hide(),$("#success").hide(),$("#failedMsg").html("支付请求失败，请重新提交订单"),$("#failed").show()),void 0}if("HUIKUAN"==formData.way){return alertMsg("订单提交成功, 请记住您的订单号："+d.orderid),void 0}if("TENPAY"==formData.way){return}var e=host+"/payment-status?id="+formData.orderid+"&jsoncallback=?";$.getJSON(e,function(f){1==f.status?($("#resultBody").show(),$("#status").hide(),$("#failed").hide(),$("#success").show()):($("#resultBody").show(),$("#status").hide(),$("#success").hide(),$("#failedMsg").html(f.msg),$("#failed").show())})}else{$("#resultBody").show(),$("#status").hide(),$("#success").hide(),$("#failedMsg").html(d.msg),$("#failed").show()}})}function card_verify(c,a,b){return/^[0-9a-zA-Z]+$/.test(a)&&/^[0-9a-zA-Z]+$/.test(b)?"JUNNET"==c?16==a.length&&16==b.length?!0:(alertMsg("只支持卡号、密码都是16位阿拉伯数字的骏网卡"),!1):"SNDACARD"==c?a.length>=15&&b.length>=8?!0:(alertMsg("只支持卡号15位或16位数字字母，密码8位或9位的阿拉伯数字的盛大点卡。 "),!1):"ZHENGTU"==c?16==a.length&&8==b.length?!0:(alertMsg("只支持全国官方征途游戏充值卡，卡号16位数字，密码8位数字。"),!1):"TELECOM"==c?a.length>=19&&b.length>=18?!0:(alertMsg('只支持电信全国卡和广东卡，卡号19位，密码18位数字（即：可拨打11888充值话费的卡）。 卡号第四位为"1"的为全国卡，为"2"的则为地方卡。 '),!1):"UNICOM"==c?15==a.length&&19==b.length?!0:(alertMsg("只支持联通全国卡，卡号15位数字，密码19位数字。 "),!1):"NETEASE"==c?a.length>=13&&b.length>=9?!0:(alertMsg("只支持全国官方网易游戏充值卡，卡号13位、密码9位数字。"),!1):"JIUYOU"==c?13==a.length&&10==b.length?!0:(alertMsg("只支持卡号13位、密码10位数字的久游点卡，不支持久游神兵卡、矩阵卡。"),!1):"WANMEI"==c?10==a.length&&15==b.length?!0:(alertMsg("只支持全国官方完美游戏充值卡，卡号10位、密码15位数字。"),!1):"YPCARD"==c&&a.length>=12&&b.length>=10?!0:"SZX"==c?a.length>9&&b.length>=8?!0:(alertMsg("只支持移动全国卡：卡号17位、密码18位数字, 地方卡： 浙江卡号10位、密码8位, 福建卡号16位、 密码17位。 "),!1):"ZONGYOU"==c?15==a.length&&15==b.length?!0:(alertMsg("只支持卡号与密码均为15位数字的纵游一卡通。"),!1):"TIANXIA"==c?15==a.length&&8==b.length?!0:(alertMsg("只支持卡号15位数字，密码8位数字的天下一卡通。不支持天下通一卡通专项卡。"),!1):"QQCARD"==c?9==a.length&&12==b.length?!0:(alertMsg("只支持卡号9位数字、密码12位数字的Q币卡。 "),!1):!1:(alertMsg("请检查卡号和密码是否字母和数字"),!1)}function checkRole(){var d,a=$("input[name=game_id]").val(),b=$("input[name=server_id]").val(),c=$("input[name=to_username]").val();hasRole=null,d=host+"/game-role?gid="+a+"&sid="+b+"&username="+c+"&jsoncallback=?",$.getJSON(d,function(e){hasRole=1==e.status?1:0})}function checkUser(){var b,a=$("input[name=to_username]").val();hasUser=null,b=host+"/game-user?username="+a+"&r="+Math.random()+"&jsoncallback=?",$.getJSON(b,function(c){hasUser=1==c.status?1:0})}function alertMsg(a){alert(a)}function closeWin(){window.close()}function scrollToTop(){window.scrollTo(0,0)}function movePoint(){13==event.keyCode&&(event.returnValue=!1)}var hasRole=null,hasUser=null,games=new Object(),servers=new Object(),cashData={SZX:[10,20,30,50,100,300,500,1000,2000],TELECOM:[50,100,200,500,1000,2000],UNICOM:[20,30,50,100,300,500,1000,2000],SNDACARD:[10,15,30,50,100,200,500,1000,2000],ZHENGTU:[10,15,18,20,30,50,60,68,120,150,180,208,300,468,500,1000,2000],NETEASE:[10,15,20,30,50,100,200,500,1000,2000],JUNNET:[10,15,30,50,100,200,500,1000,2000],JIUYOU:[10,30,50,100,200,500,1000,2000],ALIPAY:[],WANMEI:[15,30,50,100,200,500,1000,2000],QQCARD:[5,10,15,20,30,60,100,200,500,1000,2000],BANK:[],TIANXIA:[10,50,100,200,500,1000,2000],ZONGYOU:[10,50,100,200,500,1000,2000],YPCARD:[10,50,100,200,500,1000,2000],DEFAULT:[10,30,50,100,200,300,400,500,600,700,800,900,1000,1500,2000,3000,4000,5000,6000,7000,8000,9000,10000]};$(document).ready(function(){var a=host+"/game-api_ios?act=g&r="+Math.random()+"&jsoncallback=?";$.getJSON(a,function(c){if(0==c.r&&c.data.total>0){var f=c.list,b="<option value='0'>请选择游戏</option>";$(f).each(function(e,i){var d=parseInt(i.id);games[d]=i,b+="<option value='"+i.id+"'>"+i.name+"</option>"}),$("#s_game").html(b)}})});
